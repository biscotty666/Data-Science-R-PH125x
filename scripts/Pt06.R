## ---------------------------------------------------------------------------------------------
# install.packages("data.table")
library(data.table)


## ---------------------------------------------------------------------------------------------
library(dslabs)
data(murders)
murders <- setDT(murders)
murders


## ---------------------------------------------------------------------------------------------
murders[, c("state", "region")] |> head()


## ---------------------------------------------------------------------------------------------
murders[, rate := total / population * 100000]


## ---------------------------------------------------------------------------------------------
head(murders)


## ---------------------------------------------------------------------------------------------
murders[, ":="(rate = total / population * 10^5, rank = rank(population))]
head(murders)


## ---------------------------------------------------------------------------------------------
murders[rate <= 0.7]


## ---------------------------------------------------------------------------------------------
murders[rate <= 0.7, .(state, rate)]


## ---------------------------------------------------------------------------------------------
murders |> dplyr::filter(rate <= 0.7) |> dplyr::select(state, rate)


## ---------------------------------------------------------------------------------------------
library(data.table)
library(dslabs)
data(murders)
murders <- setDT(murders)


## ---------------------------------------------------------------------------------------------
murders[, rate := total / population * 10^5]
murders


## ---------------------------------------------------------------------------------------------
murders[, rank := rank(-rate)]
murders


## ---------------------------------------------------------------------------------------------
murders[, .(state, abb)]


## ---------------------------------------------------------------------------------------------
murders[rank <= 5]


## ---------------------------------------------------------------------------------------------
no_south <- murders[region != "South"]
nrow(no_south)


## ---------------------------------------------------------------------------------------------
murders_nw <- murders[region %in% c("Northeast", "West")]
nrow(murders_nw)


## ---------------------------------------------------------------------------------------------
my_state <- murders[region == c("Northeast", "West") & rate < 1, .(state, rate, rank)]
my_state


## ---------------------------------------------------------------------------------------------
library(dplyr)
library(dslabs)
data(heights)
heights <- setDT(heights)
head(heights)


## ---------------------------------------------------------------------------------------------
s <- heights |>
  summarise(average = mean(height), standard_deviation = sd(height))
head(s)


## ---------------------------------------------------------------------------------------------
s <- heights[, .(average = mean(height), standard_deviation = sd(height))]
head(s)


## ---------------------------------------------------------------------------------------------
s <- heights |>
  filter(sex == "Female") |>
  summarize(average = mean(height),
            standard_deviation = sd(height))
head(s)


## ---------------------------------------------------------------------------------------------
s <- heights[sex == "Female", 
             .(
               average = mean(height), 
               standard_deviation = sd(height)
               )]
head(s)


## ---------------------------------------------------------------------------------------------
median_min_max <- function(x) {
  qs <- quantile(x, c(0.5, 0, 1))
  data.frame(median = qs[1], 
             minimum = qs[2],
             maximum = qs[3])
}


## ---------------------------------------------------------------------------------------------
heights[, .(median_min_max(height))]


## ---------------------------------------------------------------------------------------------
heights[, .(average = mean(height), standard_deviation = sd(height)), by = sex]


## ---------------------------------------------------------------------------------------------
murders[order(population)] |> head()


## ---------------------------------------------------------------------------------------------
murders[order(region, rate)]


## ---------------------------------------------------------------------------------------------
library(NHANES)
data(NHANES)
NHANES <- setDT(NHANES)
head(NHANES)


## ---------------------------------------------------------------------------------------------
ref <- NHANES[AgeDecade == " 20-29" & Gender == "female",
              .(average = mean(BPSysAve, na.rm = TRUE), 
                standard_deviation = sd(BPSysAve, na.rm = TRUE))]
ref


## ---------------------------------------------------------------------------------------------
NHANES[AgeDecade == " 20-29" & Gender == "female",
       .(minimum = min(BPSysAve, na.rm = TRUE), 
         maximum = max(BPSysAve, na.rm = TRUE))]


## ---------------------------------------------------------------------------------------------
NHANES[Gender == "female",
       .(average = mean(BPSysAve, na.rm = TRUE), 
         standard_deviation = sd(BPSysAve, na.rm = TRUE)),
       by = AgeDecade]


## ---------------------------------------------------------------------------------------------
NHANES[Gender == "male",
       .(average = mean(BPSysAve, na.rm = TRUE), 
         standard_deviation = sd(BPSysAve, na.rm = TRUE)),
       by = AgeDecade]


## ---------------------------------------------------------------------------------------------
NHANES[Gender == "male" & AgeDecade == " 40-49",
       .(average = mean(BPSysAve, na.rm = TRUE)),
       by = "Race1"]

